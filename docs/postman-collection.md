# Postman Collection: Banking API

Документация по всем доступным эндпоинтам проекта.

## 1. Аутентификация (получение токена)

### POST `/api/auth/login`

Позволяет получить JWT-токен для последующей работы с защищёнными эндпоинтами.

**Запрос:**
- Примеры рабочих логинов: ID:1 = **ivan@mail.com**, **79201112233**. ID:2 = **79209998877**, **petr@mail.com**
```json
{
  "login": "79201112233",
  "password": "123123123"
}
```

**Ответ:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**Ошибки:**
- `401 Unauthorized` — неправильные логин/пароль.

**Пояснение:**
- Можно логиниться как по email, так и по телефону.
- Один пароль у всех тестовых пользователей: `123123123`

### X. Поиск пользователей

**Все запросы требуют передачи JWT-токена в заголовке:**
```
Authorization: Bearer {token}
```

---

### 2. Поиск пользователей

**Все запросы требуют передачи JWT-токена в заголовке:**
```
Authorization: Bearer {token}
```

---

### GET `/api/users`

#### 1. Найти пользователей с фильтрацией и пагинацией

**Доступные параметры поиска:**
- `name` — Часть имени (по началу).
- `email` — Точное совпадение email.
- `phone` — Точное совпадение телефона.
- `dateOfBirthAfter` — Выборка пользователей, родившихся позже указанной даты.
- `page` — Номер страницы (начиная с 0).
- `size` — Размер страницы (количество записей).

**Варианты поиска:**
- По имени (по началу).
- По точному email.
- По точному телефону.
- По дате рождения позже заданной даты.
- Сочетание фильтров.

**Примеры запросов:**
- По имени:
```
GET /api/users?name=Ivan&page=0&size=10
```
- По email:
```
GET /api/users?email=ivan@mail.com&page=0&size=10
```
- По телефону:
```
GET /api/users?phone=79201112233&page=0&size=10
```
- По дате рождения:
```
GET /api/users?dateOfBirthAfter=1989-01-01&page=0&size=10
```
- Сочетание фильтров:
```
GET /api/users?name=Ivan&email=ivan@mail.com&phone=79201112233&dateOfBirthAfter=1989-01-01&page=0&size=10
```

**Ответ:**
- `200 OK` — Список пользователей с пагинацией.
- `400 Bad Request` — Некорректные параметры запроса.

---

### 3. Перевод средств между пользователями

**Все запросы требуют передачи JWT-токена в заголовке:**
```
Authorization: Bearer {token}
```

### POST `/api/transfer`

#### 1. Перевести средства другому пользователю

**Тело запроса:**
```json
{
  "toUserId": 2,
  "amount": 100.00
}
```

**Ответ:**
- `201 Created` — Перевод успешно выполнен.
- `400 Bad Request` — Некорректные данные (неверный ID получателя, некорректная сумма).
- `403 Forbidden` — Попытка отправить средства самому себе.
- `404 Not Found` — Один из счетов не найден (отправитель или получатель).
- `409 Conflict` — Недостаточно средств для перевода.

> ID отправителя берётся из JWT-токена авторизованного пользователя.

---

### 4. Управление телефонами

**Все запросы требуют передачи JWT-токена в заголовке:**
```
Authorization: Bearer {token}
```

### POST `/api/users/phones`

#### 1. Добавить новый телефон

**Тело запроса:**
```json
{
  "phone": "79991234567"
}
```

**Ответ:**
- `201 Created` — Телефон успешно добавлен.
- `400 Bad Request` — Некорректные данные.
- `409 Conflict` — Телефон уже существует.

### PATCH `/api/users/phones/{phoneId}`

#### 2. Обновить существующий телефон

**Тело запроса:**
```json
{
  "newPhone": "79997654321"
}
```

**Ответ:**
- `204 No Content` — Телефон успешно обновлен.
- `400 Bad Request` — Некорректные данные.
- `403 Forbidden` — Нет прав на изменение.
- `404 Not Found` — Телефон не найден.

> Если у вас токен от пользователя с ID = 1, то изменять телефон, принадлежащий другому ID, не получится.

### DELETE `/api/users/phones/{phoneId}`

#### 3. Удалить телефон пользователя

**Ответ:**
- `204 No Content` — Телефон успешно удалён.
- `403 Forbidden` — Нет прав на удаление.
- `404 Not Found` — Телефон не найден.

> Если токен выдан для ID = 1, то удалять телефон другого пользователя нельзя.

---

## 5. Управление email-адресами

**Все запросы требуют передавать JWT-токен в заголовке:**
```
Authorization: Bearer {token}
```

### POST `/api/users/emails`

#### 1. Добавить новый email пользователю.

**Тело запроса:**
```json
{
  "email": "newemail@example.com"
}
```

**Ответ:**
- `201 Created` — email успешно добавлен.
- `400 Bad Request` — некорректные данные.
- `409 Conflict` — email уже существует.

### PATCH `/api/users/emails/{emailId}`

#### 2. Обновить существующий email пользователя.

**Тело запроса:**
```json
{
  "newEmail": "updatedemail@example.com"
}
```

**Ответ:**
- `204 No Content` — email успешно обновлен.
- `400 Bad Request` — некорректные данные.
- `403 Forbidden` — нет прав на изменение.
- `404 Not Found` — email не найден.

> Если у вас токен от пользователя c ID = 1, то изменить email, который принадлежит другому ID, не получится.

### DELETE `/api/users/emails/{emailId}`

#### 3. Удалить email пользователя.

**Ответ:**
- `204 No Content` — email успешно удален.
- `403 Forbidden` — нет прав на удаление.
- `404 Not Found` — email не найден.

> Если токен дан от пользователя ID = 1, то удалять email другого ID нельзя.
